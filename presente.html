<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Torneo de Padel - Presentismo</title>
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <link rel="stylesheet" href="/style.css" />
</head>

<body>
  <!-- Topnav -->
  <div class="topnav">
    <a class="topnav-link" href="/">ğŸ‘¤ Mis Partidos</a>
    <a class="topnav-link" href="/general">ğŸ‘€ Todos los Resultados</a>
    <a class="topnav-link" href="/fixture">ğŸ“‹ Fixture</a>
    <a class="topnav-link" href="/carga">ğŸ“² Cargar</a>
    <a class="topnav-link" href="/admin">ğŸ›  Admin</a>
    <a class="topnav-link" href="/presente">âœ… Presentismo</a>
    <a class="topnav-link" href="/analytics">ğŸ“Š Analytics</a>
  </div>

  <div class="container">
    <h1>GestiÃ³n de Presentismo</h1>

    <!-- SECCIÃ“N 1: Toggle Global -->
    <details class="admin-section" open>
      <summary>ğŸŒ Sistema de Presentismo (toggle global)</summary>

      <p class="helper" style="margin-top:8px;">
        ActivÃ¡ o desactivÃ¡ el sistema de presentismo para todo el torneo.
        Cuando estÃ¡ desactivado, no se muestran badges y no se solicita confirmaciÃ³n.
      </p>

      <div class="presentismo-toggle-container" style="margin:14px 0;">
        <div class="presentismo-toggle-card">
          <div class="presentismo-toggle-info">
            <div class="presentismo-toggle-label">Sistema de Presentismo</div>
            <div class="presentismo-toggle-status" id="presentismo-status">
              <!-- Se inyecta: "Activo âœ…" o "Desactivado âŒ" -->
            </div>
          </div>
          <label class="toggle-switch">
            <input type="checkbox" id="presentismo-global-toggle" />
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>
    </details>

    <!-- SECCIÃ“N 2: EstadÃ­sticas RÃ¡pidas -->
    <details class="admin-section" open>
      <summary>ğŸ“Š Resumen del Torneo</summary>

      <div id="stats-container" class="presentismo-stats">
        <!-- Se inyecta dinÃ¡micamente -->
      </div>
    </details>

    <!-- SECCIÃ“N 3: Operaciones Masivas -->
    <details class="admin-section">
      <summary>âš¡ Operaciones Masivas</summary>

      <p class="helper" style="margin-top:8px;">
        Marcar o desmarcar jugadores en lote. Ideal para inicio del torneo o reseteo completo.
      </p>

      <!-- Safety bar -->
      <div id="admin-safe-bar" class="admin-safety">
        <label class="admin-safety-label">
          <input id="admin-safe-toggle" type="checkbox" />
          Desbloquear acciones peligrosas
        </label>
        <span id="admin-safe-badge" class="admin-safety-badge">Modo seguro</span>
      </div>

      <div class="admin-actions">
        <button id="marcar-todos-presentes" type="button">âœ… Marcar TODOS presentes</button>
        <button id="desmarcar-todos" type="button" data-danger="hard">ğŸ§¹ Limpiar TODOS</button>
      </div>

      <!-- Operaciones por grupo -->
      <h3 style="margin-top:18px;">Por Grupo</h3>
      <div id="grupos-bulk-container" class="grupos-bulk">
        <!-- Se inyecta dinÃ¡micamente -->
      </div>
    </details>

    <!-- SECCIÃ“N 4: Vista por Parejas (Control Granular) -->
    <details class="admin-section" open>
      <summary>ğŸ‘¥ Control por Pareja</summary>

      <!-- Filtros y bÃºsqueda -->
      <div class="presentismo-filters" style="margin:12px 0;">
        <input
          id="parejas-search"
          type="search"
          class="search__input"
          placeholder="Buscar pareja o jugador..."
          autocomplete="off"
        />

        <div class="segmented" style="margin-top:10px;">
          <button class="segmented__btn is-active" data-filtro="todas" id="filtro-todas">
            Todas
          </button>
          <button class="segmented__btn" data-filtro="completas" id="filtro-completas">
            âœ… Completas
          </button>
          <button class="segmented__btn" data-filtro="incompletas" id="filtro-incompletas">
            âš ï¸ Incompletas
          </button>
          <button class="segmented__btn" data-filtro="ausentes" id="filtro-ausentes">
            âŒ Ausentes
          </button>
        </div>
      </div>

      <!-- Lista de parejas -->
      <div id="parejas-container" class="parejas-presentismo">
        <!-- Se inyecta dinÃ¡micamente: grilla de parejas -->
      </div>

      <div class="admin-actions" style="margin-top:12px;">
        <button id="refresh-parejas" type="button">ğŸ”„ Refrescar Vista</button>
      </div>
    </details>

    <!-- SECCIÃ“N 5: Ausentes (Vista RÃ¡pida) -->
    <details class="admin-section">
      <summary>âš ï¸ Jugadores Ausentes</summary>

      <p class="helper" style="margin-top:8px;">
        Lista de jugadores que aÃºn no marcaron presencia. Acciones rÃ¡pidas desde acÃ¡.
      </p>

      <div id="ausentes-container" class="ausentes-lista">
        <!-- Se inyecta dinÃ¡micamente -->
      </div>
    </details>

    <!-- Log -->
    <h2>Log</h2>
    <div id="log" class="log"></div>
  </div>

  <script type="module" src="/src/presente.js"></script>
  <script>
    // Marcar link activo
    (function () {
      const path = (location.pathname.endsWith('/') ? location.pathname : location.pathname + '/');
      document.querySelectorAll('.topnav-link').forEach(a => {
        const href = a.getAttribute('href');
        const norm = (href.endsWith('/') ? href : href + '/');
        if (norm === path) a.classList.add('is-active');
      });
    })();
  </script>
</body>
</html>
