# Badge de Presentismo - Dise√±o Visual Simplificado

**Fecha:** 2026-02-10
**Status:** Aprobado

---

## Concepto

**Visual directo con colores** en lugar de badges expandibles. Info visible de un vistazo sin interacci√≥n.

---

## Dise√±o Visual

### ‚úÖ Todos Presentes (SE PUEDE JUGAR)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ #3  [‚úÖ]  Grupo A ¬∑ Ronda 1            ‚îÇ ‚Üê Badge verde simple
‚îÇ Nico-Fede vs Santi-Mati                ‚îÇ ‚Üê Todos en VERDE
‚îÇ [‚ñ∂ En juego]                           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### ‚ö†Ô∏è Info Incompleta (Faltan Jugadores)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ #9  [‚ö†Ô∏è]  Grupo B ¬∑ Ronda 2            ‚îÇ ‚Üê Badge warning (amarillo/naranja)
‚îÇ Nico-Fede vs Santi-Mati                ‚îÇ ‚Üê Nico y Santi VERDE
‚îÇ                                        ‚îÇ    Fede y Mati GRIS
‚îÇ [‚ñ∂ En juego]                           ‚îÇ ‚Üê Habilitado (con confirmaci√≥n)
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ #12 [‚ö†Ô∏è]  Grupo C ¬∑ Ronda 1            ‚îÇ ‚Üê Badge warning
‚îÇ Marcos-Leo vs Gaby-Flor                ‚îÇ ‚Üê Todos GRIS (nadie)
‚îÇ [‚ñ∂ En juego]                           ‚îÇ ‚Üê Habilitado (con confirmaci√≥n)
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üéØ Filosof√≠a: Guiar, No Bloquear

**Principio fundamental de la app**: Asumir que puede tener informaci√≥n incompleta o err√≥nea.

- ‚úÖ **Guiar**: Badge visual advierte de posible problema
- ‚úÖ **Confirmar**: Di√°logo pregunta si est√° seguro
- ‚úÖ **Auto-corregir**: Si confirma, marca jugadores como presentes
- ‚ùå **NO bloquear**: Siempre permite continuar

### Flujo de Confirmaci√≥n

```
Usuario hace click en "En juego" (con badge ‚ö†Ô∏è)
‚Üì
Sistema muestra di√°logo:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ          ¬øEst√°s seguro?                 ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Me figura que Fede y Mati est√°n        ‚îÇ
‚îÇ  ausentes. ¬øEst√°s seguro que quer√©s     ‚îÇ
‚îÇ  iniciar este partido?                  ‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ  üí° Si inici√°s el partido, los marcar√©  ‚îÇ
‚îÇ     como presentes autom√°ticamente.     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  [No, volver]    [S√≠, iniciar partido] ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚Üì
Si confirma:
  1. Marca Fede y Mati como presentes en BD
  2. Muestra toast: "‚úÖ Marcados como presentes: Fede, Mati"
  3. Procede con la acci√≥n (iniciar partido, cargar resultado, etc.)
```

---

## L√≥gica Simplificada (2 Estados)

| Estado | Condici√≥n | Badge | Bot√≥n | Acci√≥n |
|--------|-----------|-------|-------|--------|
| **Todos presentes** | 4/4 presentes | ‚úÖ Verde | Habilitado | Ejecuta directamente |
| **Info incompleta** | 0/4, 1/4, 2/4 o 3/4 | ‚ö†Ô∏è Amarillo/Naranja | Habilitado | Pide confirmaci√≥n + auto-corrige |

---

## Colores

**Jugadores:**
- üü¢ Verde (`#16A34A`): Presente
- ‚ö™ Gris (`#9CA3AF`): Ausente

**Badge del partido:**
- ‚úÖ Verde: Todos presentes (procede directo)
- ‚ö†Ô∏è Amarillo/Naranja (`#F59E0B`): Info incompleta (pide confirmaci√≥n)

**Border del card:**
- Verde (4px left): Todos presentes
- Amarillo/Naranja (4px left): Info incompleta

---

## Ventajas

| Aspecto | Beneficio |
|---------|-----------|
| **Visibilidad** | Todo visible sin interacci√≥n |
| **Mobile** | No requiere tap/hover |
| **Escaneabilidad** | Admin ve de un vistazo con colores |
| **Simplicidad** | 2 estados claros |
| **Performance** | No requiere estado/toggle |

---

## Implementaci√≥n

```javascript
/**
 * Calcula estado visual de un partido seg√∫n presentismo individual
 */
function calcularEstadoVisualPartido(partido, parejasMap) {
  const parejaA = parejasMap.get(partido.pareja_a_id);
  const parejaB = parejasMap.get(partido.pareja_b_id);

  // Parsear nombres individuales (formato: "Nico-Fede")
  const [jugadorA1, jugadorA2] = parejaA.nombre.split('-').map(n => n.trim());
  const [jugadorB1, jugadorB2] = parejaB.nombre.split('-').map(n => n.trim());

  // Verificar presencia individual
  const presentesA = parejaA.presentes || [];
  const presentesB = parejaB.presentes || [];

  const jugadores = [
    { nombre: jugadorA1, presente: presentesA.includes(jugadorA1), pareja: 'A' },
    { nombre: jugadorA2, presente: presentesA.includes(jugadorA2), pareja: 'A' },
    { nombre: jugadorB1, presente: presentesB.includes(jugadorB1), pareja: 'B' },
    { nombre: jugadorB2, presente: presentesB.includes(jugadorB2), pareja: 'B' }
  ];

  const totalPresentes = jugadores.filter(j => j.presente).length;
  const sePuedeJugar = totalPresentes === 4;

  return {
    jugadores,
    totalPresentes,
    todosPresentes: sePuedeJugar,
    ausentes: jugadores.filter(j => !j.presente),
    badge: {
      icono: sePuedeJugar ? '‚úÖ' : '‚ö†Ô∏è',
      clase: sePuedeJugar ? 'todos-presentes' : 'info-incompleta'
    }
  };
}
```

### Renderizado HTML

```html
<div class="partido-card ${estadoVisual.badge.clase}">
  <div class="partido-header">
    <span class="badge-presentismo ${estadoVisual.badge.clase}">
      ${estadoVisual.badge.icono}
    </span>
    <span class="partido-numero">#${posicion}</span>
    <span class="partido-grupo">Grupo ${grupo} ¬∑ Ronda ${ronda}</span>
  </div>

  <div class="partido-parejas">
    <span class="jugador ${estadoVisual.jugadores[0].presente ? 'presente' : 'ausente'}">
      ${estadoVisual.jugadores[0].nombre}
    </span>-<span class="jugador ${estadoVisual.jugadores[1].presente ? 'presente' : 'ausente'}">
      ${estadoVisual.jugadores[1].nombre}
    </span>

    <span class="vs">vs</span>

    <span class="jugador ${estadoVisual.jugadores[2].presente ? 'presente' : 'ausente'}">
      ${estadoVisual.jugadores[2].nombre}
    </span>-<span class="jugador ${estadoVisual.jugadores[3].presente ? 'presente' : 'ausente'}">
      ${estadoVisual.jugadores[3].nombre}
    </span>
  </div>

  <!-- Bot√≥n SIEMPRE habilitado -->
  <button
    class="btn-en-juego"
    onclick="manejarAccionConValidacion(partido, estadoVisual)"
  >
    ‚ñ∂ En juego
  </button>
</div>
```

### Funci√≥n de Validaci√≥n

```javascript
/**
 * Maneja acci√≥n con validaci√≥n de presentismo
 * Gu√≠a al usuario pero NO bloquea
 */
async function manejarAccionConValidacion(partido, estadoVisual) {
  // Si todos presentes, ejecutar directamente
  if (estadoVisual.todosPresentes) {
    return ejecutarAccion(partido);
  }

  // Si faltan jugadores, pedir confirmaci√≥n
  const ausentes = estadoVisual.ausentes.map(j => j.nombre);
  const mensaje = ausentes.length === 1
    ? `Me figura que ${ausentes[0]} est√° ausente.`
    : `Me figura que ${ausentes.join(', ')} est√°n ausentes.`;

  const confirmado = await mostrarDialogoConfirmacion({
    titulo: '¬øEst√°s seguro?',
    mensaje: mensaje,
    detalle: '¬øEst√°s seguro que quer√©s continuar?',
    nota: 'Si continu√°s, los marcar√© como presentes autom√°ticamente.',
    botones: {
      cancelar: 'No, volver',
      confirmar: 'S√≠, continuar'
    }
  });

  if (!confirmado) return;

  // Auto-correcci√≥n: marcar ausentes como presentes
  await marcarJugadoresComoPresentesAutomaticamente(partido, ausentes);
  mostrarToast(`‚úÖ Marcados como presentes: ${ausentes.join(', ')}`);

  // Ejecutar acci√≥n
  return ejecutarAccion(partido);
}
```

### CSS

```css
/* Jugadores */
.jugador {
  font-weight: 600;
  transition: color 0.2s ease;
}

.jugador.presente {
  color: #16A34A; /* Verde */
}

.jugador.ausente {
  color: #9CA3AF; /* Gris */
  opacity: 0.7;
}

/* Badge de presentismo */
.badge-presentismo {
  display: inline-block;
  padding: 4px 8px;
  border-radius: 4px;
  font-size: 14px;
  font-weight: 700;
  line-height: 1;
}

.badge-presentismo.todos-presentes {
  background: rgba(22, 163, 74, 0.12);
  color: #16A34A;
  border: 1px solid #16A34A;
}

.badge-presentismo.info-incompleta {
  background: rgba(251, 191, 36, 0.12);  /* Amarillo/Naranja warning */
  color: #F59E0B;
  border: 1px solid #F59E0B;
}

/* Card del partido */
.partido-card {
  border-radius: 8px;
  padding: 16px;
  margin-bottom: 12px;
  background: white;
  transition: all 0.2s ease;
}

.partido-card.todos-presentes {
  border-left: 4px solid #16A34A;
}

.partido-card.info-incompleta {
  border-left: 4px solid #F59E0B;  /* Warning, no error */
  opacity: 1;  /* Sin reducir opacidad */
}

/* Responsive */
@media (max-width: 640px) {
  .badge-presentismo {
    font-size: 12px;
    padding: 3px 6px;
  }

  .jugador {
    font-size: 14px;
  }
}
```

---

## Consideraciones Arquitect√≥nicas

### Presentismo Individual

‚ö†Ô∏è **Importante:** Aunque la BD almacena por parejas (`presentes TEXT[]` en tabla `parejas`), el presentismo es por **jugador individual**.

**Ejemplo v√°lido:**
- Pareja "Nico-Fede" ‚Üí `presentes = ['Nico']` (solo Nico, Fede ausente)
- Pareja "Santi-Mati" ‚Üí `presentes = ['Santi']` (solo Santi, Mati ausente)
- **Resultado:** Partido con 2/4 presentes (Nico y Santi) ‚Üí ‚ùå NO se puede jugar

### Cambio Futuro (Documentado)

**Refactor propuesto** (m√°s adelante):
- Tabla `jugadores` con presentismo por jugador
- Tabla `parejas` referencia 2 jugadores
- Permite reutilizar jugadores en diferentes parejas

**Decisi√≥n:** Implementar M√ÅS ADELANTE, la estructura actual funciona.

---

## Filtro "Solo con Todos Presentes"

```
‚òëÔ∏è Solo mostrar con todos presentes [‚úÖ]
```

**Efecto:**
- Activo: muestra solo partidos con badge ‚úÖ (4/4)
- Desactivo: muestra todos

**Uso:**
- Admin al inicio: activa filtro ‚Üí ve solo lo jugable
- Admin despu√©s: desactiva ‚Üí ve todo

---

## Testing

### Escenarios de Prueba

1. **Todos presentes (4/4)**
   - Badge: ‚úÖ verde
   - Nombres: todos verdes
   - Bot√≥n: habilitado
   - Border: verde
   - **Acci√≥n**: Ejecuta directamente sin confirmaci√≥n

2. **Parcial (2/4)**
   - Badge: ‚ö†Ô∏è amarillo/naranja
   - Nombres: 2 verdes, 2 grises
   - Bot√≥n: habilitado
   - Border: amarillo/naranja
   - **Acci√≥n**: Muestra di√°logo de confirmaci√≥n
   - **Si confirma**: Marca ausentes como presentes + ejecuta

3. **Nadie (0/4)**
   - Badge: ‚ö†Ô∏è amarillo/naranja
   - Nombres: todos grises
   - Bot√≥n: habilitado
   - Border: amarillo/naranja
   - **Acci√≥n**: Muestra di√°logo de confirmaci√≥n
   - **Si confirma**: Marca todos como presentes + ejecuta

4. **Mobile**
   - Info visible sin tap
   - Colores claros
   - No requiere interacci√≥n
   - Di√°logo de confirmaci√≥n funciona en mobile

5. **Auto-correcci√≥n**
   - Usuario confirma acci√≥n a pesar de ausentes
   - Sistema marca ausentes como presentes en BD
   - Muestra toast de confirmaci√≥n
   - Refresca vista con colores actualizados
